<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Username Generator</title>
    <meta name="Generates a fun username (:" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- AJAX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
     <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <!-- Twitter web intent -->
    <script type="text/javascript" async src="//platform.twitter.com/widgets.js"></script>
    <!-- Custom stylesheet -->
    <link href="stylesheets/style.css" rel="stylesheet">
    <!-- Spinner -->
    <script src="javascripts/spin.min.js"></script>

  </head>
  <body>

    <div class="container-fluid">

      <div class="row">
        <div class="col-md-12">
          Your username is:
        </div>
      </div>

      <div class="row">
        <div class="col-md-12" id="username-container">
          <h2 id="username"></h2>
        </div>
      </div>

       <div class="row">
        <div class="col-md-12">
          <button type="button" class="btn btn-default" id="new">New Username</button>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <a href='#'>Tweet this username</a>
        </div>
      </div>
        
    </div>

    <script>

      $('#new').click(function() {
        refreshUsername();
      });

      var refreshing = false;

      function refreshUsername() {

          if (refreshing) {
            return;
          }

          $('#username').text('');
          setLoading(true);
          request = $.get('api/get-username', function( data ) {
            setLoading(false);
            $('#username').text(data);
            var tweet = 'https://twitter.com/intent/tweet?text=' + 'Thanks to usernames420.com, I\'m changing+my+twitter+name+to:+' + data;
            $("a").attr("href", tweet);
          });
      }

      var spinner;

      function setLoading(loading) {

        refreshing = loading;

        if (!spinner) {
          var opts = {
            lines: 11, // The number of lines to draw
            length: 6, // The length of each line
            width: 2, // The line thickness
            radius: 14, // The radius of the inner circle
            corners: 1, // Corner roundness (0..1)
            rotate: 0, // The rotation offset
            direction: 1, // 1: clockwise, -1: counterclockwise
            color: '#111', // #rgb or #rrggbb or array of colors
            speed: 1.6, // Rounds per second
            trail: 51, // Afterglow percentage
            shadow: false, // Whether to render a shadow
            hwaccel: false, // Whether to use hardware acceleration
            className: 'spinner', // The CSS class to assign to the spinner
            zIndex: 2e9, // The z-index (defaults to 2000000000)
            top: '50%', // Top position relative to parent
            left: '50%' // Left position relative to parent
          }

          spinner = new Spinner(opts).spin();
        } 

        if (loading) {
          $('#username-container').append(spinner.el);
        } else {
          spinner.el.remove();
          spinner = null;
        }
      }

      refreshUsername();

    </script>

  </body>
</html>